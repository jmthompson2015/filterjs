!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilterJS=t()}(this,(function(){"use strict";const e={IS_TRUE:"boIsTrue",IS_FALSE:"boIsFalse",properties:{boIsTrue:{label:"is true",compareFunction:e=>!0===e,key:"boIsTrue"},boIsFalse:{label:"is false",compareFunction:e=>!1===e,key:"boIsFalse"}},keys:()=>Object.keys(e.properties),values:()=>Object.values(e.properties)};Object.freeze(e);const t={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",properties:{boolean:{name:"Boolean",key:"boolean"},number:{name:"Number",key:"number"},string:{name:"String",key:"string"}},keys:()=>Object.keys(t.properties),values:()=>Object.values(t.properties)};Object.freeze(t);const s={IS:"noIs",IS_NOT:"noIsNot",IS_GREATER_THAN:"noIsGreaterThan",IS_LESS_THAN:"noIsLessThan",IS_IN_THE_RANGE:"noIsInTheRange",properties:{noIs:{label:"is",compareFunction:(e,t)=>e===t,key:"noIs"},noIsNot:{label:"is not",compareFunction:(e,t)=>e!==t,key:"noIsNot"},noIsGreaterThan:{label:"is greater than",compareFunction:(e,t)=>e>t,key:"noIsGreaterThan"},noIsLessThan:{label:"is less than",compareFunction:(e,t)=>e<t,key:"noIsLessThan"},noIsInTheRange:{label:"is in the range",compareFunction:(e,t,s)=>t<=e&&e<=s,key:"noIsInTheRange"}},keys:()=>Object.keys(s.properties),values:()=>Object.values(s.properties)};Object.freeze(s);const n={CONTAINS:"soContains",DOES_NOT_CONTAIN:"soDoesNotContain",IS:"soIs",IS_NOT:"soIsNot",BEGINS_WITH:"soBeginsWith",ENDS_WITH:"soEndsWith"},r=(e,t,s)=>{if(R.isNil(e)||R.isNil(t))return!1;const r=n.toString(e);if(t.includes("|")){const e=t.split("|"),n=(e,t)=>s(r,t.trim())||e;return R.reduce(n,!1,e)}return s(r,t)},a=(e,t)=>r(e,t,((e,t)=>{const s=n.toString(e),r=n.toString(t);return!!s&&s.includes(r)})),l=(e,t)=>r(e,t,((e,t)=>e===t));n.properties={soContains:{label:"contains",compareFunction:a,key:"soContains"},soDoesNotContain:{label:"does not contain",compareFunction:(e,t)=>!a(e,t),key:"soDoesNotContain"},soIs:{label:"is",compareFunction:l,key:"soIs"},soIsNot:{label:"is not",compareFunction:(e,t)=>!l(e,t),key:"soIsNot"},soBeginsWith:{label:"begins with",compareFunction:(e,t)=>r(e,t,((e,t)=>e.startsWith(t))),key:"soBeginsWith"},soEndsWith:{label:"ends with",compareFunction:(e,t)=>r(e,t,((e,t)=>e.endsWith(t))),key:"soEndsWith"}},n.toString=e=>{let t=e;if(e)if(Array.isArray(e)){t=R.map(n.toString,e).join(" ")}else{const s=typeof e;switch(s){case"object":t=R.toLower(Object.values(e).join(" "));break;case"boolean":case"number":t=`${e}`;break;case"string":t=R.toLower(e);break;default:console.error(`Unknown item: ${e} type: ${s}`)}}return t},n.keys=()=>Object.keys(n.properties),n.values=()=>Object.values(n.properties),Object.freeze(n);const i={booleanOperator:t=>e.properties[t],clauseType:e=>t.properties[e],clauseTypeByOperator:e=>{let s=t.STRING;return i.booleanOperator(e)?s=t.BOOLEAN:i.numberOperator(e)&&(s=t.NUMBER),s},compareFunction:e=>i.operator(e).compareFunction,numberOperator:e=>s.properties[e],operator:e=>i.booleanOperator(e)||i.numberOperator(e)||i.stringOperator(e),operatorType:r=>{let a=n;if(r)switch(r){case t.BOOLEAN:a=e;break;case t.NUMBER:a=s;break;case t.STRING:default:a=n}return a},stringOperator:e=>n.properties[e]};Object.freeze(i);const o={create:({itemKey:e,operatorKey:t,rhs:s,rhs2:n})=>Immutable({itemKey:e,operatorKey:t,rhs:s,rhs2:n}),default:(r,a)=>{let l;if(r)switch(a){case t.BOOLEAN:l=o.create({itemKey:r,operatorKey:Object.keys(e.properties)[0]});break;case t.NUMBER:l=o.create({itemKey:r,operatorKey:Object.keys(s.properties)[0],rhs:0});break;case t.STRING:case void 0:l=o.create({itemKey:r,operatorKey:Object.keys(n.properties)[0],rhs:""});break;default:throw new Error(`Unknown clauseType: ${a}`)}return l},isBooleanClause:t=>!R.isNil(t)&&e.keys().includes(t.operatorKey),isNumberClause:e=>!R.isNil(e)&&s.keys().includes(e.operatorKey),isStringClause:e=>!R.isNil(e)&&n.keys().includes(e.operatorKey),passes:(e,t)=>{if(e&&t){const s=i.compareFunction(e.operatorKey);if(s){return s(t[e.itemKey],e.rhs,e.rhs2)}}return!1}};Object.freeze(o);const c={create:({name:e="Filter",clauses:t=[]})=>Immutable({name:e,clauses:t}),default:(e,t=1)=>{const s=R.filter((e=>[void 0,"true",!0].includes(e.isShown)),e),n=s&&s.length>0?s[0]:void 0,r=o.default(n.key,n.type),a=r?[r]:[];return c.create({name:`Filter ${t}`,clauses:a})},passes:(e,t)=>{if(e&&t){const s=(e,s)=>e&&o.passes(s,t);return R.reduce(s,!0,e.clauses)}return!1}};Object.freeze(c);const p={create:({filters:e=[],selectedIndex:t})=>{let s=0;return Number.isInteger(t)&&t>=0&&t<e.length&&(s=t),Immutable({filters:e,selectedIndex:s})},default:e=>{const t=[c.default(e)];return p.create({filters:t})},selectedFilter:e=>{let t;if(e){const{filters:s,selectedIndex:n}=e;t=s[n]}return t}};Object.freeze(p);const u={tableColumn:(e,t)=>{const s=R.filter((e=>e.key===t),e);return s.length>0?s[0]:void 0}};Object.freeze(u);const h=ReactComponent.ReactUtilities,d=e=>"string"==typeof e?Number(e):e;class C extends React.PureComponent{constructor(e){super(e),this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(){const{addOnClick:e,index:t}=this.props;e(t)}handleChangeFunction(){const{index:e,onChange:s,tableColumns:n}=this.props,r=((e,t)=>{const s=document.getElementById(`columnSelect${t}`).value;return u.tableColumn(e,s)})(n,e),a=((e,t)=>{const s=document.getElementById(`operatorSelect${t}`).value,n=i.operatorType(e.type),r=n.values();return n.keys().includes(s)?s:r[0].key})(r,e),l=(e=>{const t=document.getElementById(`rhsField${e}`);return t?t.value:void 0})(e),c=(e=>{const t=document.getElementById(`rhs2Field${e}`);return t?t.value:void 0})(e);let p;switch(r.type){case t.BOOLEAN:p=o.create({itemKey:r.key,operatorKey:a});break;case t.NUMBER:p=o.create({itemKey:r.key,operatorKey:a,rhs:d(l)||0,rhs2:d(c)});break;case t.STRING:case void 0:p=o.create({itemKey:r.key,operatorKey:a,rhs:l||""});break;default:throw new Error(`Unknown column.type: ${r.type}`)}s(p,e)}handleRemoveOnClickFunction(){const{removeOnClick:e,index:t}=this.props;e(t)}createClauseUI(e,n,r,a,l){const{numberInputClass:o,stringInputClass:c}=this.props;let p;switch(i.clauseTypeByOperator(e.operatorKey)){case t.BOOLEAN:p=(e=>h.createCell("",`rhsBooleanField${e}`))(n);break;case t.NUMBER:p=((e,t,n,r,a,l,i)=>{const o=`rhsField${t}`,c=e?d(e.rhs):void 0;if(e.operatorKey===s.IS_IN_THE_RANGE){const s=e?d(e.rhs2):void 0,p=[h.createCell(React.createElement(ReactComponent.NumberInput,{id:o,className:r,initialValue:c||0,max:l,min:a,step:i,onBlur:n}),`rhs1NumberField1${t}`),h.createCell(ReactDOMFactories.span({className:"ph1"},"to"),`toField${t}`),h.createCell(React.createElement(ReactComponent.NumberInput,{id:`rhs2Field${t}`,className:r,initialValue:s||0,max:l,min:a,step:i,onBlur:n}),`rhs2NumberField3${t}`)],u=h.createRow(p,`toRow${t}`),C=h.createTable(u,`toTable${t}`);return h.createCell(C,`toCell${t}`)}return h.createCell(React.createElement(ReactComponent.NumberInput,{id:o,className:r,initialValue:c||0,max:l,min:a,step:i,onBlur:n}),`rhsNumberField1${t}`)})(e,n,this.handleChange,o,r,a,l);break;case t.STRING:p=((e,t,s,n)=>{const r=`rhsField${t}`;return h.createCell(React.createElement(ReactComponent.StringInput,{id:r,className:n,initialValue:e?e.rhs:void 0,onBlur:s}),`rhsStringField1${t}`)})(e,n,this.handleChange,c);break;default:throw new Error(`Unknown clause clauseTypeKey: ${e.clauseTypeKey}`)}return p}render(){const{className:e,clause:t,index:s,isRemoveHidden:n,tableColumns:r}=this.props,a=((e,t)=>{const s=Object.values(e)[0].key,n=t&&t.itemKey||s;return u.tableColumn(e,n)})(r,t);var l,o;const c=[h.createCell(((e,t,s,n,r)=>React.createElement(ReactComponent.Select,{id:`columnSelect${s}`,className:"fjs-select",values:e,initialValue:n.key,onChange:r}))(r,0,s,a,this.handleChange),`${a.key}ColumnSelectCell${s}`),h.createCell(((e,t,s,n)=>{const r=i.operatorType(s.type);if(r){const s=r.values();return React.createElement(ReactComponent.Select,{id:`operatorSelect${t}`,className:"fjs-select",values:s,initialValue:e?e.operatorKey:void 0,onChange:n})}return null})(t,s,a,this.handleChange),`${a.key}OperatorSelectCell${s}`),this.createClauseUI(t,s,a.min,a.max,a.step),h.createCell((l=n,o=this.handleRemoveOnClick,ReactDOMFactories.button({disabled:l,onClick:o},"-")),`removeButtonCell${s}`),h.createCell((e=>ReactDOMFactories.button({onClick:e},"+"))(this.handleAddOnClick),`addButtonCell${s}`)];return h.createRow(c,`${a.key}ClauseUI${s}`,e)}}C.propTypes={addOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,className:PropTypes.string,clause:PropTypes.shape(),index:PropTypes.number,isRemoveHidden:PropTypes.bool,numberInputClass:PropTypes.string,stringInputClass:PropTypes.string},C.defaultProps={className:void 0,clause:void 0,index:void 0,isRemoveHidden:!1,numberInputClass:"w3",stringInputClass:"w4"};const m=ReactComponent.ReactUtilities;class b extends React.PureComponent{constructor(e){super(e);const{filter:t,tableColumns:s}=this.props,n=t||c.default(s);this.state={filter:n,isApplied:!1},this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleFilterOnClick=this.handleFilterOnClickFunction.bind(this),this.handleNameChange=this.handleNameChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this),this.handleUnfilterOnClick=this.handleUnfilterOnClickFunction.bind(this)}handleAddOnClickFunction(e){const{onChange:t,tableColumns:s}=this.props,{filter:n}=this.state,r=s[0],a=o.default(r.key,r.type);if(a){const s=R.insert(e+1,a,n.clauses),r=c.create({name:n.name,clauses:s});this.setState({filter:r}),t(r)}}handleChangeFunction(e,t){const{onChange:s}=this.props,{filter:n}=this.state,r=R.update(t,e,n.clauses),a=c.create({name:n.name,clauses:r});this.setState({filter:a}),s(a)}handleFilterOnClickFunction(){const{applyOnClick:e}=this.props;this.setState({isApplied:!0}),e()}handleNameChangeFunction(e){const{onChange:t}=this.props,{filter:s}=this.state,n=c.create({name:e,clauses:s.clauses});this.setState({filter:n}),t(n)}handleRemoveOnClickFunction(e){const{onChange:t}=this.props,{filter:s}=this.state,n=R.remove(e,1,s.clauses),r=c.create({name:s.name,clauses:n});this.setState({filter:r}),t(r)}handleUnfilterOnClickFunction(){const{removeOnClick:e}=this.props;this.setState({isApplied:!1}),e()}createButtonTable(){const{isApplied:e}=this.state,t=ReactDOMFactories.button({onClick:this.handleUnfilterOnClick,disabled:!e},"Remove"),s=ReactDOMFactories.button({onClick:this.handleFilterOnClick,disabled:e},"Apply"),n=[m.createCell(t,"unfilterButton"),m.createCell(s,"filterButton")],r=m.createRow(n,"button-row");return m.createTable(r,"buttonTable","fr")}createClauseTable(){const e=[],{tableColumns:t}=this.props,{filter:s}=this.state,{handleAddOnClick:n,handleChange:r,handleRemoveOnClick:a}=this,l=s||c.default(t),i=R.concat([],l.clauses);if(0===i.length){const e=t[0],s=o.default(e.key,e.type);s&&i.push(s)}for(let s=0;s<i.length;s+=1){const l=i[s],o=1===i.length&&0===s,c=React.createElement(C,{key:`ClauseUI${s}`,clause:l,index:s,isRemoveHidden:o,tableColumns:t,onChange:r,addOnClick:n,removeOnClick:a});e.push(c)}return m.createTable(e,"clauseTable")}render(){const{buttonPanelClass:e,className:t,filter:s,filterNameClass:n,inputPanelClass:r}=this.props,a=React.createElement(ReactComponent.StringInput,{initialValue:s?s.name:"Filter",onBlur:this.handleNameChange}),l=this.createClauseTable(),i=this.createButtonTable(),o=m.createCell(a,"filterNameTable",n),c=m.createCell(l,"clauseTable",r),p=m.createCell(i,"buttonPanelCell",e),u=[m.createRow(o,"nameRow"),m.createRow(c,"clausesRow"),m.createRow(p,"buttonRow")];return m.createTable(u,"filterTable",t)}}b.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,buttonPanelClass:PropTypes.string,className:PropTypes.string,filter:PropTypes.shape(),filterNameClass:PropTypes.string,inputPanelClass:PropTypes.string},b.defaultProps={buttonPanelClass:"pt2",className:void 0,filter:void 0,filterNameClass:"pb2 tl",inputPanelClass:void 0};const f=ReactComponent.ReactUtilities,y=R.addIndex(R.map),k=R.addIndex(R.reduce);class O extends React.PureComponent{constructor(e){super(e);const{initialFilterGroup:t}=this.props;this.state={filterGroup:t},this.handleDeleteOnClick=this.handleDeleteOnClickFunction.bind(this),this.handleFilterChange=this.handleFilterChangeFunction.bind(this),this.handleFiltersChange=this.handleFiltersChangeFunction.bind(this),this.handleMoveDownOnClick=this.handleMoveDownOnClickFunction.bind(this),this.handleMoveUpOnClick=this.handleMoveUpOnClickFunction.bind(this),this.handleNewOnClick=this.handleNewOnClickFunction.bind(this)}handleFilterChangeFunction(e){const{onChange:t}=this.props,{filterGroup:s}=this.state,{filters:n,selectedIndex:r}=s,a=((e,t,s)=>y(((s,n)=>n===e?t:s),s))(r,e,n),l=p.create({filters:a,selectedIndex:r});this.setState({filterGroup:l}),t(l)}handleFiltersChangeFunction(e){const{onChange:t}=this.props,{filterGroup:s}=this.state,{filters:n}=s,r=R.map(R.prop("name"),n).indexOf(e),a=p.create({filters:n,selectedIndex:r});this.setState({filterGroup:a}),t(a)}handleDeleteOnClickFunction(){const{onChange:e}=this.props,{filterGroup:t}=this.state,{filters:s,selectedIndex:n}=t,r=((e,t)=>k(((t,s,n)=>n===e?t:R.append(s,t)),[],t))(n,s),a=n>0?n-1:0,l=p.create({filters:r,selectedIndex:a});this.setState({filterGroup:l}),e(l)}handleMoveDownOnClickFunction(){const{onChange:e}=this.props,{filterGroup:t}=this.state,{filters:s,selectedIndex:n}=t,r=n+1,a=R.move(n,r,R.concat([],s)),l=p.create({filters:a,selectedIndex:r});this.setState({filterGroup:l}),e(l)}handleMoveUpOnClickFunction(){const{onChange:e}=this.props,{filterGroup:t}=this.state,{filters:s,selectedIndex:n}=t,r=n-1,a=R.move(n,r,R.concat([],s)),l=p.create({filters:a,selectedIndex:r});this.setState({filterGroup:l}),e(l)}handleNewOnClickFunction(){const{onChange:e,tableColumns:t}=this.props,{filterGroup:s}=this.state,{filters:n}=s,r=n.length,a=c.default(t,r+1),l=R.append(a,n),i=p.create({filters:l,selectedIndex:r});this.setState({filterGroup:i}),e(i)}createButtonTable(){const{filterGroup:e}=this.state,{filters:t,selectedIndex:s}=e,n=s>=t.length-1,r=ReactDOMFactories.button({onClick:this.handleMoveDownOnClick,disabled:n},"⇩"),a=s<1,l=ReactDOMFactories.button({onClick:this.handleMoveUpOnClick,disabled:a},"⇧"),i=t.length<=1,o=ReactDOMFactories.button({onClick:this.handleDeleteOnClick,disabled:i},"-"),c=ReactDOMFactories.button({onClick:this.handleNewOnClick},"+"),p=[f.createCell(r,"moveDownFilterButton"),f.createCell(l,"moveUpFilterButton"),f.createCell(o,"deleteFilterButton"),f.createCell(c,"newFilterButton")],u=f.createRow(p,"button-row");return f.createTable(u,"buttonTable")}createFiltersList(){const{filterGroup:e}=this.state,{filters:t,selectedIndex:s}=e,n=t[s],r=Math.max(2+n.clauses.length,5),a=n.name,l=R.map(R.prop("name"),t),i=R.reduce(((e,t)=>R.append({key:t,label:t},e)),[],l);return React.createElement(ReactComponent.Select,{key:`${r}${JSON.stringify(n)}`,attributes:{size:r},initialValue:a,onChange:this.handleFiltersChange,values:i})}createFiltersTable(){const e=this.createFiltersList(),t=this.createButtonTable(),s=f.createCell(e,"filtersList"),n=f.createCell(t,"buttonTable","pt2"),r=[f.createRow(s,"filtersListRow"),f.createRow(n,"buttonTableRow")];return f.createTable(r,"filtersTable")}createFilterUI(){const{applyOnClick:e,removeOnClick:t,tableColumns:s}=this.props,{filterGroup:n}=this.state,{filters:r,selectedIndex:a}=n,l=r.length>0?r[a]:void 0;return React.createElement(b,{key:JSON.stringify(l.clauses),applyOnClick:e,filter:l,onChange:this.handleFilterChange,removeOnClick:t,tableColumns:s})}render(){const{className:e,filterEditorClass:t,filtersListClass:s}=this.props,n=this.createFiltersTable(),r=this.createFilterUI(),a=[f.createCell(n,"filtersTable",s),f.createCell(r,"filterUI",t)],l=f.createRow(a,"filtersTableRow");return f.createTable(l,"filtersTable",e)}}O.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,className:PropTypes.string,filterEditorClass:PropTypes.string,filtersListClass:PropTypes.string,initialFilterGroup:PropTypes.shape()},O.defaultProps={className:void 0,filterEditorClass:"v-top",filtersListClass:"pr2 v-top",initialFilterGroup:[]};class F{}return F.BooleanOperator=e,F.ClauseType=t,F.NumberOperator=s,F.StringOperator=n,F.Clause=o,F.Filter=c,F.FilterGroup=p,F.FilterUI=b,F.FilterGroupUI=O,F}));
