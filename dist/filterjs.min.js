!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilterJS=t()}(this,(function(){"use strict";const e={IS_TRUE:"boIsTrue",IS_FALSE:"boIsFalse",properties:{boIsTrue:{label:"is true",compareFunction:e=>!0===e,key:"boIsTrue"},boIsFalse:{label:"is false",compareFunction:e=>!1===e,key:"boIsFalse"}},keys:()=>Object.keys(e.properties),values:()=>Object.values(e.properties)};Object.freeze(e);const t={IS:"noIs",IS_NOT:"noIsNot",IS_GREATER_THAN:"noIsGreaterThan",IS_LESS_THAN:"noIsLessThan",IS_IN_THE_RANGE:"noIsInTheRange",properties:{noIs:{label:"is",compareFunction:(e,t)=>e===t,key:"noIs"},noIsNot:{label:"is not",compareFunction:(e,t)=>e!==t,key:"noIsNot"},noIsGreaterThan:{label:"is greater than",compareFunction:(e,t)=>e>t,key:"noIsGreaterThan"},noIsLessThan:{label:"is less than",compareFunction:(e,t)=>e<t,key:"noIsLessThan"},noIsInTheRange:{label:"is in the range",compareFunction:(e,t,n)=>t<=e&&e<=n,key:"noIsInTheRange"}},keys:()=>Object.keys(t.properties),values:()=>Object.values(t.properties)};Object.freeze(t);const n={CONTAINS:"soContains",DOES_NOT_CONTAIN:"soDoesNotContain",IS:"soIs",IS_NOT:"soIsNot",BEGINS_WITH:"soBeginsWith",ENDS_WITH:"soEndsWith"},r=(e,t,n)=>{if(R.isNil(e)||R.isNil(t))return!1;const r=Array.isArray(e)?e.join(" "):e;if(t.includes("|")){const e=t.split("|"),s=(e,t)=>n(r,t.trim())||e;return R.reduce(s,!1,e)}return n(r,t)},s=(e,t)=>r(e,t,((e,t)=>R.toLower(e).includes(R.toLower(t)))),o=(e,t)=>r(e,t,((e,t)=>e===t));n.properties={soContains:{label:"contains",compareFunction:s,key:"soContains"},soDoesNotContain:{label:"does not contain",compareFunction:(e,t)=>!s(e,t),key:"soDoesNotContain"},soIs:{label:"is",compareFunction:o,key:"soIs"},soIsNot:{label:"is not",compareFunction:(e,t)=>!o(e,t),key:"soIsNot"},soBeginsWith:{label:"begins with",compareFunction:(e,t)=>r(e,t,((e,t)=>e.startsWith(t))),key:"soBeginsWith"},soEndsWith:{label:"ends with",compareFunction:(e,t)=>r(e,t,((e,t)=>e.endsWith(t))),key:"soEndsWith"}},n.keys=()=>Object.keys(n.properties),n.values=()=>Object.values(n.properties),Object.freeze(n);const a={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",properties:{boolean:{name:"Boolean",key:"boolean"},number:{name:"Number",key:"number"},string:{name:"String",key:"string"}},keys:()=>Object.keys(a.properties),values:()=>Object.values(a.properties)};Object.freeze(a);const l={booleanOperator:t=>e.properties[t],clauseType:e=>a.properties[e],clauseTypeByOperator:e=>{let t=a.STRING;return l.booleanOperator(e)?t=a.BOOLEAN:l.numberOperator(e)&&(t=a.NUMBER),t},compareFunction:e=>l.operator(e).compareFunction,numberOperator:e=>t.properties[e],operator:e=>l.booleanOperator(e)||l.numberOperator(e)||l.stringOperator(e),operatorType:r=>{let s=n;if(r)switch(r){case a.BOOLEAN:s=e;break;case a.NUMBER:s=t;break;case a.STRING:default:s=n}return s},stringOperator:e=>n.properties[e]};Object.freeze(l);const i={create:({itemKey:e,operatorKey:t,rhs:n,rhs2:r})=>Immutable({itemKey:e,operatorKey:t,rhs:n,rhs2:r}),isBooleanClause:t=>!R.isNil(t)&&e.keys().includes(t.operatorKey),isNumberClause:e=>!R.isNil(e)&&t.keys().includes(e.operatorKey),isStringClause:e=>!R.isNil(e)&&n.keys().includes(e.operatorKey),passes:e=>t=>{if(e&&t){const n=l.compareFunction(e.operatorKey);if(n){return n(t[e.itemKey],e.rhs,e.rhs2)}}return!1}};Object.freeze(i);const c={create:({name:e="Filter",clauses:t=[]})=>Immutable({name:e,clauses:t}),passes:e=>t=>{if(e&&t){const n=(e,n)=>e&&i.passes(n)(t);return R.reduce(n,!0,e.clauses)}return!1}};Object.freeze(c);const u={createCell:(e,t,n,r={})=>{const s=R.merge(r,{key:t,className:n,style:{display:"table-cell"}});return ReactDOMFactories.div(s,e)},createRow:(e,t,n,r={})=>{const s=R.merge(r,{key:t,className:n,style:{display:"table-row"}});return ReactDOMFactories.div(s,e)},createTable:(e,t,n,r={})=>{const s=R.merge(r,{key:t,className:n,style:{display:"table"}});return ReactDOMFactories.div(s,e)}},p={tableColumn:(e,t)=>{const n=R.filter((e=>e.key===t),e);return n.length>0?n[0]:void 0}};Object.freeze(p);const d=e=>"string"==typeof e?Number(e):e,h=e=>u.createCell("",e),m=(e,n,r,s,o,i)=>{let c;switch(l.clauseTypeByOperator(e.operatorKey)){case a.BOOLEAN:c=(e=>[h(`rhsBooleanField1${e}`),h(`rhsBooleanField2${e}`),h(`rhsBooleanField3${e}`)])(n);break;case a.NUMBER:c=((e,n,r,s,o,a)=>{const l=`rhsField${n}`,i=e?d(e.rhs):void 0;if(e.operatorKey===t.IS_IN_THE_RANGE){const t=e?d(e.rhs2):void 0;return[u.createCell(React.createElement(ReactComponent.NumberInput,{id:l,className:"field",initialValue:i||0,max:o,min:s,step:a,onBlur:r}),`rhs1NumberField1${n}`),u.createCell(ReactDOMFactories.span({style:{paddingLeft:3,paddingRight:3}},"to"),`toField${n}`),u.createCell(React.createElement(ReactComponent.NumberInput,{id:`rhs2Field${n}`,className:"field",initialValue:t||0,max:o,min:s,step:a,onBlur:r}),`rhs2NumberField3${n}`)]}return[u.createCell(React.createElement(ReactComponent.NumberInput,{id:l,className:"field",initialValue:i||0,max:o,min:s,step:a,onBlur:r}),`rhsNumberField1${n}`),h(`rhsNumberField2${n}`),h(`rhsNumberField3${n}`)]})(e,n,r,s,o,i);break;case a.STRING:c=((e,t,n)=>{const r=`rhsField${t}`;return[u.createCell(React.createElement(ReactComponent.StringInput,{id:r,className:"field",initialValue:e?e.rhs:void 0,onBlur:n}),`rhsStringField1${t}`),h(`rhsStringField2${t}`),h(`rhsStringField3${t}`)]})(e,n,r);break;default:throw new Error(`Unknown clause clauseTypeKey: ${e.clauseTypeKey}`)}return c};class b extends React.PureComponent{constructor(e){super(e),this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(){const{addOnClick:e,index:t}=this.props;e(t)}handleChangeFunction(){const{index:e,onChange:t,tableColumns:n}=this.props,r=((e,t)=>{const n=document.getElementById(`columnSelect${t}`).value;return p.tableColumn(e,n)})(n,e),s=((e,t)=>{const n=document.getElementById(`operatorSelect${t}`).value,r=l.operatorType(e.type),s=r.values();return r.keys().includes(n)?n:s[0].key})(r,e),o=(e=>{const t=document.getElementById(`rhsField${e}`);return t?t.value:void 0})(e),c=(e=>{const t=document.getElementById(`rhs2Field${e}`);return t?t.value:void 0})(e);let u;switch(r.type){case a.BOOLEAN:u=i.create({itemKey:r.key,operatorKey:s});break;case a.NUMBER:u=i.create({itemKey:r.key,operatorKey:s,rhs:d(o)||0,rhs2:d(c)});break;case a.STRING:case void 0:u=i.create({itemKey:r.key,operatorKey:s,rhs:o||""});break;default:throw new Error(`Unknown column.type: ${r.type}`)}t(u,e)}handleRemoveOnClickFunction(){const{removeOnClick:e,index:t}=this.props;e(t)}render(){const{clause:e,index:t,isRemoveHidden:n,tableColumns:r}=this.props,s=((e,t)=>{const n=Object.values(e)[0].key,r=t&&t.itemKey||n;return p.tableColumn(e,r)})(r,e);var o;const a=[u.createCell(((e,t,n,r,s)=>React.createElement(ReactComponent.Select,{id:`columnSelect${n}`,values:e,initialValue:r.key,onChange:s}))(r,0,t,s,this.handleChange),`${s.key}ColumnSelectCell${t}`),u.createCell(((e,t,n,r)=>{const s=l.operatorType(n.type);if(s){const n=s.values();return React.createElement(ReactComponent.Select,{id:`operatorSelect${t}`,values:n,initialValue:e?e.operatorKey:void 0,onChange:r})}return null})(e,t,s,this.handleChange),`${s.key}OperatorSelectCell${t}`),m(e,t,this.handleChange,s.min,s.max,s.step),u.createCell(((e,t)=>ReactDOMFactories.button({hidden:e,onClick:t},"-"))(n,this.handleRemoveOnClick),`removeButtonCell${t}`),u.createCell((o=this.handleAddOnClick,ReactDOMFactories.button({onClick:o},"+")),`addButtonCell${t}`)];return u.createRow(a,`${s.key}ClauseUI${t}`,"fjs-clause-row")}}b.propTypes={addOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,clause:PropTypes.shape(),index:PropTypes.number,isRemoveHidden:PropTypes.bool},b.defaultProps={clause:void 0,index:void 0,isRemoveHidden:!1};const y=r=>{let s;if(r)switch(r.type){case a.BOOLEAN:s=i.create({itemKey:r.key,operatorKey:Object.keys(e.properties)[0]});break;case a.NUMBER:s=i.create({itemKey:r.key,operatorKey:Object.keys(t.properties)[0],rhs:0});break;case a.STRING:case void 0:s=i.create({itemKey:r.key,operatorKey:Object.keys(n.properties)[0],rhs:""});break;default:throw new Error(`Unknown tableColumn.type: ${r.type}`)}return s},C=e=>{const t=R.filter((e=>[void 0,"true",!0].includes(e.isShown)),e),n=t&&t.length>0?t[0]:void 0,r=[y(n)];return c.create({name:"Filter 1",clauses:r})};class k extends React.PureComponent{constructor(e){super(e);const{filter:t,tableColumns:n}=this.props,r=t||C(n);this.state={filter:r},this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(e){const{onChange:t,tableColumns:n}=this.props,{filter:r}=this.state,s=n[0],o=y(s),a=R.insert(e+1,o,r.clauses),l=c.create({name:r.name,clauses:a});this.setState({filter:l}),t(l)}handleChangeFunction(e,t){const{onChange:n}=this.props,{filter:r}=this.state,s=R.update(t,e,r.clauses),o=c.create({name:r.name,clauses:s});this.setState({filter:o}),n(o)}handleRemoveOnClickFunction(e){const{onChange:t}=this.props,{filter:n}=this.state,r=R.remove(e,1,n.clauses),s=c.create({name:n.name,clauses:r});this.setState({filter:s}),t(s)}createButtonTable(){const{applyOnClick:e,removeOnClick:t}=this.props,n=ReactDOMFactories.button({onClick:t},"Remove"),r=ReactDOMFactories.button({onClick:e},"Apply"),s=[u.createCell(n,"unfilterButton","button"),u.createCell(r,"filterButton","button")],o=u.createRow(s,"button-row");return u.createTable(o,"buttonTable","buttons")}createTable(){const e=[],{tableColumns:t}=this.props,{filter:n}=this.state,{handleAddOnClick:r,handleChange:s,handleRemoveOnClick:o}=this,a=n||C(t),l=R.concat([],a.clauses);if(0===l.length){const e=t[0],n=y(e);l.push(n)}for(let n=0;n<l.length;n+=1){const a=l[n],i=1===l.length&&0===n,c=React.createElement(b,{key:`ClauseUI${n}`,clause:a,index:n,isRemoveHidden:i,tableColumns:t,onChange:s,addOnClick:r,removeOnClick:o});e.push(c)}return u.createTable(e,"filterTable")}render(){const e=u.createCell(this.createTable(),"filterTable","inner-table"),t=u.createRow(e,"filterTableCells"),n=u.createTable(t,"filterTableRow"),r=u.createCell(n,"filterTable"),s=u.createCell(this.createButtonTable(),"buttonTable","button-panel"),o=[u.createRow(r,"filterTablesRow"),u.createRow(s,"buttonRow")];return u.createTable(o,"filterTable","fjs-filter")}}k.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,filter:PropTypes.shape()},k.defaultProps={filter:void 0};class O{}return O.BooleanOperator=e,O.NumberOperator=t,O.StringOperator=n,O.Clause=i,O.Filter=c,O.FilterUI=k,O}));
