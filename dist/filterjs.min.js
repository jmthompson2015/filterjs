!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilterJS=t()}(this,(function(){"use strict";const e={IS_TRUE:"boIsTrue",IS_FALSE:"boIsFalse",properties:{boIsTrue:{label:"is true",compareFunction:e=>!0===e,key:"boIsTrue"},boIsFalse:{label:"is false",compareFunction:e=>!1===e,key:"boIsFalse"}},keys:()=>Object.keys(e.properties),values:()=>Object.values(e.properties)};Object.freeze(e);const t={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",properties:{boolean:{name:"Boolean",key:"boolean"},number:{name:"Number",key:"number"},string:{name:"String",key:"string"}},keys:()=>Object.keys(t.properties),values:()=>Object.values(t.properties)};Object.freeze(t);const n={IS:"noIs",IS_NOT:"noIsNot",IS_GREATER_THAN:"noIsGreaterThan",IS_LESS_THAN:"noIsLessThan",IS_IN_THE_RANGE:"noIsInTheRange",properties:{noIs:{label:"is",compareFunction:(e,t)=>e===t,key:"noIs"},noIsNot:{label:"is not",compareFunction:(e,t)=>e!==t,key:"noIsNot"},noIsGreaterThan:{label:"is greater than",compareFunction:(e,t)=>e>t,key:"noIsGreaterThan"},noIsLessThan:{label:"is less than",compareFunction:(e,t)=>e<t,key:"noIsLessThan"},noIsInTheRange:{label:"is in the range",compareFunction:(e,t,n)=>t<=e&&e<=n,key:"noIsInTheRange"}},keys:()=>Object.keys(n.properties),values:()=>Object.values(n.properties)};Object.freeze(n);const s={CONTAINS:"soContains",DOES_NOT_CONTAIN:"soDoesNotContain",IS:"soIs",IS_NOT:"soIsNot",BEGINS_WITH:"soBeginsWith",ENDS_WITH:"soEndsWith"},r=(e,t,n)=>{if(R.isNil(e)||R.isNil(t))return!1;const r=s.toString(e);if(t.includes("|")){const e=t.split("|"),s=(e,t)=>n(r,t.trim())||e;return R.reduce(s,!1,e)}return n(r,t)},i=(e,t)=>r(e,t,((e,t)=>{const n=s.toString(e),r=s.toString(t);return!!n&&n.includes(r)})),a=(e,t)=>r(e,t,((e,t)=>e===t));s.properties={soContains:{label:"contains",compareFunction:i,key:"soContains"},soDoesNotContain:{label:"does not contain",compareFunction:(e,t)=>!i(e,t),key:"soDoesNotContain"},soIs:{label:"is",compareFunction:a,key:"soIs"},soIsNot:{label:"is not",compareFunction:(e,t)=>!a(e,t),key:"soIsNot"},soBeginsWith:{label:"begins with",compareFunction:(e,t)=>r(e,t,((e,t)=>e.startsWith(t))),key:"soBeginsWith"},soEndsWith:{label:"ends with",compareFunction:(e,t)=>r(e,t,((e,t)=>e.endsWith(t))),key:"soEndsWith"}},s.toString=e=>{let t=e;if(e)if(Array.isArray(e)){t=R.map(s.toString,e).join(" ")}else{const n=typeof e;switch(n){case"object":t=R.toLower(Object.values(e).join(" "));break;case"boolean":case"number":t=`${e}`;break;case"string":t=R.toLower(e);break;default:console.error(`Unknown item: ${e} type: ${n}`)}}return t},s.keys=()=>Object.keys(s.properties),s.values=()=>Object.values(s.properties),Object.freeze(s);const l={booleanOperator:t=>e.properties[t],clauseType:e=>t.properties[e],clauseTypeByOperator:e=>{let n=t.STRING;return l.booleanOperator(e)?n=t.BOOLEAN:l.numberOperator(e)&&(n=t.NUMBER),n},compareFunction:e=>l.operator(e).compareFunction,numberOperator:e=>n.properties[e],operator:e=>l.booleanOperator(e)||l.numberOperator(e)||l.stringOperator(e),operatorType:r=>{let i=s;if(r)switch(r){case t.BOOLEAN:i=e;break;case t.NUMBER:i=n;break;case t.STRING:default:i=s}return i},stringOperator:e=>s.properties[e]};Object.freeze(l);const o={create:({itemKey:e,operatorKey:t,rhs:n,rhs2:s})=>Immutable({itemKey:e,operatorKey:t,rhs:n,rhs2:s}),default:(r,i)=>{let a;if(r)switch(i){case t.BOOLEAN:a=o.create({itemKey:r,operatorKey:Object.keys(e.properties)[0]});break;case t.NUMBER:a=o.create({itemKey:r,operatorKey:Object.keys(n.properties)[0],rhs:0});break;case t.STRING:case void 0:a=o.create({itemKey:r,operatorKey:Object.keys(s.properties)[0],rhs:""});break;default:throw new Error(`Unknown clauseType: ${i}`)}return a},isBooleanClause:t=>!R.isNil(t)&&e.keys().includes(t.operatorKey),isNumberClause:e=>!R.isNil(e)&&n.keys().includes(e.operatorKey),isStringClause:e=>!R.isNil(e)&&s.keys().includes(e.operatorKey),passes:(e,t)=>{if(e&&t){const n=l.compareFunction(e.operatorKey);if(n){return n(t[e.itemKey],e.rhs,e.rhs2)}}return!1}};Object.freeze(o);const c={create:({name:e="Filter",clauses:t=[]})=>Immutable({name:e,clauses:t}),default:(e,t=1)=>{const n=R.filter((e=>[void 0,"true",!0].includes(e.isShown)),e),s=n&&n.length>0?n[0]:void 0,r=o.default(s.key,s.type),i=r?[r]:[];return c.create({name:`Filter ${t}`,clauses:i})},passes:(e,t)=>{if(e&&t){const n=(e,n)=>e&&o.passes(n,t);return R.reduce(n,!0,e.clauses)}return!1}};Object.freeze(c);const u={create:({filters:e=[],selectedIndex:t})=>{let n=0;return Number.isInteger(t)&&t>=0&&t<e.length&&(n=t),Immutable({filters:e,selectedIndex:n})},default:e=>{const t=[c.default(e)];return u.create({filters:t})},selectedFilter:e=>{let t;if(e){const{filters:n,selectedIndex:s}=e;t=n[s]}return t}};Object.freeze(u);const p={tableColumn:(e,t)=>{const n=R.filter((e=>e.key===t),e);return n.length>0?n[0]:void 0}};Object.freeze(p);const h=ReactComponent.ReactUtilities,d=e=>"string"==typeof e?Number(e):e,b=e=>h.createCell("",e),m=(e,s,r,i,a,o)=>{let c;switch(l.clauseTypeByOperator(e.operatorKey)){case t.BOOLEAN:c=(e=>[b(`rhsBooleanField1${e}`),b(`rhsBooleanField2${e}`),b(`rhsBooleanField3${e}`)])(s);break;case t.NUMBER:c=((e,t,s,r,i,a)=>{const l=`rhsField${t}`,o=e?d(e.rhs):void 0;if(e.operatorKey===n.IS_IN_THE_RANGE){const n=e?d(e.rhs2):void 0;return[h.createCell(React.createElement(ReactComponent.NumberInput,{id:l,className:"fjs-number-input",initialValue:o||0,max:i,min:r,step:a,onBlur:s}),`rhs1NumberField1${t}`),h.createCell(ReactDOMFactories.span({style:{paddingLeft:3,paddingRight:3}},"to"),`toField${t}`),h.createCell(React.createElement(ReactComponent.NumberInput,{id:`rhs2Field${t}`,className:"fjs-number-input",initialValue:n||0,max:i,min:r,step:a,onBlur:s}),`rhs2NumberField3${t}`)]}return[h.createCell(React.createElement(ReactComponent.NumberInput,{id:l,className:"fjs-number-input",initialValue:o||0,max:i,min:r,step:a,onBlur:s}),`rhsNumberField1${t}`),b(`rhsNumberField2${t}`),b(`rhsNumberField3${t}`)]})(e,s,r,i,a,o);break;case t.STRING:c=((e,t,n)=>{const s=`rhsField${t}`;return[h.createCell(React.createElement(ReactComponent.StringInput,{id:s,className:"fjs-string-input",initialValue:e?e.rhs:void 0,onBlur:n}),`rhsStringField1${t}`),b(`rhsStringField2${t}`),b(`rhsStringField3${t}`)]})(e,s,r);break;default:throw new Error(`Unknown clause clauseTypeKey: ${e.clauseTypeKey}`)}return c};class C extends React.PureComponent{constructor(e){super(e),this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(){const{addOnClick:e,index:t}=this.props;e(t)}handleChangeFunction(){const{index:e,onChange:n,tableColumns:s}=this.props,r=((e,t)=>{const n=document.getElementById(`columnSelect${t}`).value;return p.tableColumn(e,n)})(s,e),i=((e,t)=>{const n=document.getElementById(`operatorSelect${t}`).value,s=l.operatorType(e.type),r=s.values();return s.keys().includes(n)?n:r[0].key})(r,e),a=(e=>{const t=document.getElementById(`rhsField${e}`);return t?t.value:void 0})(e),c=(e=>{const t=document.getElementById(`rhs2Field${e}`);return t?t.value:void 0})(e);let u;switch(r.type){case t.BOOLEAN:u=o.create({itemKey:r.key,operatorKey:i});break;case t.NUMBER:u=o.create({itemKey:r.key,operatorKey:i,rhs:d(a)||0,rhs2:d(c)});break;case t.STRING:case void 0:u=o.create({itemKey:r.key,operatorKey:i,rhs:a||""});break;default:throw new Error(`Unknown column.type: ${r.type}`)}n(u,e)}handleRemoveOnClickFunction(){const{removeOnClick:e,index:t}=this.props;e(t)}render(){const{clause:e,index:t,isRemoveHidden:n,tableColumns:s}=this.props,r=((e,t)=>{const n=Object.values(e)[0].key,s=t&&t.itemKey||n;return p.tableColumn(e,s)})(s,e);var i,a;const o=[h.createCell(((e,t,n,s,r)=>React.createElement(ReactComponent.Select,{id:`columnSelect${n}`,className:"fjs-select",values:e,initialValue:s.key,onChange:r}))(s,0,t,r,this.handleChange),`${r.key}ColumnSelectCell${t}`),h.createCell(((e,t,n,s)=>{const r=l.operatorType(n.type);if(r){const n=r.values();return React.createElement(ReactComponent.Select,{id:`operatorSelect${t}`,className:"fjs-select",values:n,initialValue:e?e.operatorKey:void 0,onChange:s})}return null})(e,t,r,this.handleChange),`${r.key}OperatorSelectCell${t}`),m(e,t,this.handleChange,r.min,r.max,r.step),h.createCell((i=n,a=this.handleRemoveOnClick,ReactDOMFactories.button({disabled:i,onClick:a},"-")),`removeButtonCell${t}`),h.createCell((e=>ReactDOMFactories.button({onClick:e},"+"))(this.handleAddOnClick),`addButtonCell${t}`)];return h.createRow(o,`${r.key}ClauseUI${t}`,"fjs-clause-ui")}}C.propTypes={addOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,clause:PropTypes.shape(),index:PropTypes.number,isRemoveHidden:PropTypes.bool},C.defaultProps={clause:void 0,index:void 0,isRemoveHidden:!1};const f=ReactComponent.ReactUtilities;class y extends React.PureComponent{constructor(e){super(e);const{filter:t,tableColumns:n}=this.props,s=t||c.default(n);this.state={filter:s,isApplied:!1},this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleFilterOnClick=this.handleFilterOnClickFunction.bind(this),this.handleNameChange=this.handleNameChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this),this.handleUnfilterOnClick=this.handleUnfilterOnClickFunction.bind(this)}handleAddOnClickFunction(e){const{onChange:t,tableColumns:n}=this.props,{filter:s}=this.state,r=n[0],i=o.default(r.key,r.type);if(i){const n=R.insert(e+1,i,s.clauses),r=c.create({name:s.name,clauses:n});this.setState({filter:r}),t(r)}}handleChangeFunction(e,t){const{onChange:n}=this.props,{filter:s}=this.state,r=R.update(t,e,s.clauses),i=c.create({name:s.name,clauses:r});this.setState({filter:i}),n(i)}handleFilterOnClickFunction(){const{applyOnClick:e}=this.props;this.setState({isApplied:!0}),e()}handleNameChangeFunction(e){const{onChange:t}=this.props,{filter:n}=this.state,s=c.create({name:e,clauses:n.clauses});this.setState({filter:s}),t(s)}handleRemoveOnClickFunction(e){const{onChange:t}=this.props,{filter:n}=this.state,s=R.remove(e,1,n.clauses),r=c.create({name:n.name,clauses:s});this.setState({filter:r}),t(r)}handleUnfilterOnClickFunction(){const{removeOnClick:e}=this.props;this.setState({isApplied:!1}),e()}createButtonTable(){const{isApplied:e}=this.state,t=ReactDOMFactories.button({onClick:this.handleUnfilterOnClick,disabled:!e},"Remove"),n=ReactDOMFactories.button({onClick:this.handleFilterOnClick,disabled:e},"Apply"),s=[f.createCell(t,"unfilterButton","button"),f.createCell(n,"filterButton","button")],r=f.createRow(s,"button-row");return f.createTable(r,"buttonTable","fjs-button-table fr")}createClauseTable(){const e=[],{tableColumns:t}=this.props,{filter:n}=this.state,{handleAddOnClick:s,handleChange:r,handleRemoveOnClick:i}=this,a=n||c.default(t),l=R.concat([],a.clauses);if(0===l.length){const e=t[0],n=o.default(e.key,e.type);n&&l.push(n)}for(let n=0;n<l.length;n+=1){const a=l[n],o=1===l.length&&0===n,c=React.createElement(C,{key:`ClauseUI${n}`,clause:a,index:n,isRemoveHidden:o,tableColumns:t,onChange:r,addOnClick:s,removeOnClick:i});e.push(c)}return f.createTable(e,"clauseTable")}render(){const{filter:e}=this.props,t=React.createElement(ReactComponent.StringInput,{initialValue:e?e.name:"Filter",onBlur:this.handleNameChange}),n=this.createClauseTable(),s=this.createButtonTable(),r=f.createCell(t,"filterNameTable","pb2"),i=f.createCell(n,"clauseTable"),a=f.createCell(s,"buttonTable","button-panel pt2"),l=[f.createRow(r,"nameRow"),f.createRow(i,"clausesRow"),f.createRow(a,"buttonRow")];return f.createTable(l,"filterTable","fjs-filter-ui")}}y.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,filter:PropTypes.shape()},y.defaultProps={filter:void 0};const k=ReactComponent.ReactUtilities,O=R.addIndex(R.map),F=R.addIndex(R.reduce);class g extends React.PureComponent{constructor(e){super(e);const{initialFilterGroup:t}=this.props;this.state={filterGroup:t},this.handleDeleteOnClick=this.handleDeleteOnClickFunction.bind(this),this.handleFilterChange=this.handleFilterChangeFunction.bind(this),this.handleFiltersChange=this.handleFiltersChangeFunction.bind(this),this.handleMoveDownOnClick=this.handleMoveDownOnClickFunction.bind(this),this.handleMoveUpOnClick=this.handleMoveUpOnClickFunction.bind(this),this.handleNewOnClick=this.handleNewOnClickFunction.bind(this)}handleFilterChangeFunction(e){const{onChange:t}=this.props,{filterGroup:n}=this.state,{filters:s,selectedIndex:r}=n,i=((e,t,n)=>O(((n,s)=>s===e?t:n),n))(r,e,s),a=u.create({filters:i,selectedIndex:r});this.setState({filterGroup:a}),t(a)}handleFiltersChangeFunction(e){const{onChange:t}=this.props,{filterGroup:n}=this.state,{filters:s}=n,r=R.map(R.prop("name"),s).indexOf(e),i=u.create({filters:s,selectedIndex:r});this.setState({filterGroup:i}),t(i)}handleDeleteOnClickFunction(){const{onChange:e}=this.props,{filterGroup:t}=this.state,{filters:n,selectedIndex:s}=t,r=((e,t)=>F(((t,n,s)=>s===e?t:R.append(n,t)),[],t))(s,n),i=s>0?s-1:0,a=u.create({filters:r,selectedIndex:i});this.setState({filterGroup:a}),e(a)}handleMoveDownOnClickFunction(){const{onChange:e}=this.props,{filterGroup:t}=this.state,{filters:n,selectedIndex:s}=t,r=s+1,i=R.move(s,r,R.concat([],n)),a=u.create({filters:i,selectedIndex:r});this.setState({filterGroup:a}),e(a)}handleMoveUpOnClickFunction(){const{onChange:e}=this.props,{filterGroup:t}=this.state,{filters:n,selectedIndex:s}=t,r=s-1,i=R.move(s,r,R.concat([],n)),a=u.create({filters:i,selectedIndex:r});this.setState({filterGroup:a}),e(a)}handleNewOnClickFunction(){const{onChange:e,tableColumns:t}=this.props,{filterGroup:n}=this.state,{filters:s}=n,r=s.length,i=c.default(t,r+1),a=R.append(i,s),l=u.create({filters:a,selectedIndex:r});this.setState({filterGroup:l}),e(l)}createButtonTable(){const{filterGroup:e}=this.state,{filters:t,selectedIndex:n}=e,s=n>=t.length-1,r=ReactDOMFactories.button({onClick:this.handleMoveDownOnClick,disabled:s},"⇩"),i=n<1,a=ReactDOMFactories.button({onClick:this.handleMoveUpOnClick,disabled:i},"⇧"),l=t.length<=1,o=ReactDOMFactories.button({onClick:this.handleDeleteOnClick,disabled:l},"-"),c=ReactDOMFactories.button({onClick:this.handleNewOnClick},"+"),u=[k.createCell(r,"moveDownFilterButton","button"),k.createCell(a,"moveUpFilterButton","button"),k.createCell(o,"deleteFilterButton","button"),k.createCell(c,"newFilterButton","button")],p=k.createRow(u,"button-row");return k.createTable(p,"buttonTable","fjs-button-table")}createFiltersList(){const{filterGroup:e}=this.state,{filters:t,selectedIndex:n}=e,s=t[n],r=Math.max(2+s.clauses.length,5),i=s.name,a=R.map(R.prop("name"),t),l=R.reduce(((e,t)=>R.append({key:t,label:t},e)),[],a);return React.createElement(ReactComponent.Select,{key:`${r}${JSON.stringify(s)}`,attributes:{size:r},initialValue:i,onChange:this.handleFiltersChange,values:l})}createFiltersTable(){const e=this.createFiltersList(),t=this.createButtonTable(),n=k.createCell(e,"filtersList"),s=k.createCell(t,"buttonTable","pt2"),r=[k.createRow(n,"filtersListRow"),k.createRow(s,"buttonTableRow")];return k.createTable(r,"filtersTable","fjs-filters-table")}createFilterUI(){const{applyOnClick:e,removeOnClick:t,tableColumns:n}=this.props,{filterGroup:s}=this.state,{filters:r,selectedIndex:i}=s,a=r.length>0?r[i]:void 0;return React.createElement(y,{key:JSON.stringify(a.clauses),applyOnClick:e,filter:a,onChange:this.handleFilterChange,removeOnClick:t,tableColumns:n})}render(){const e=this.createFiltersTable(),t=this.createFilterUI(),n=[k.createCell(e,"filtersTable","pr2 v-top"),k.createCell(t,"filterUI","v-top")],s=k.createRow(n,"filtersTableRow");return k.createTable(s,"filtersTable","fjs-filters-ui f6")}}g.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,initialFilterGroup:PropTypes.shape()},g.defaultProps={initialFilterGroup:[]};class T{}return T.BooleanOperator=e,T.ClauseType=t,T.NumberOperator=n,T.StringOperator=s,T.Clause=o,T.Filter=c,T.FilterGroup=u,T.FilterUI=y,T.FilterGroupUI=g,T}));
