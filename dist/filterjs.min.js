!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilterJS=t()}(this,(function(){"use strict";const e={IS_TRUE:"boIsTrue",IS_FALSE:"boIsFalse",properties:{boIsTrue:{label:"is true",compareFunction:e=>!0===e,key:"boIsTrue"},boIsFalse:{label:"is false",compareFunction:e=>!1===e,key:"boIsFalse"}},keys:()=>Object.keys(e.properties),values:()=>Object.values(e.properties)};Object.freeze(e);const t={IS:"noIs",IS_NOT:"noIsNot",IS_GREATER_THAN:"noIsGreaterThan",IS_LESS_THAN:"noIsLessThan",IS_IN_THE_RANGE:"noIsInTheRange",properties:{noIs:{label:"is",compareFunction:(e,t)=>e===t,key:"noIs"},noIsNot:{label:"is not",compareFunction:(e,t)=>e!==t,key:"noIsNot"},noIsGreaterThan:{label:"is greater than",compareFunction:(e,t)=>e>t,key:"noIsGreaterThan"},noIsLessThan:{label:"is less than",compareFunction:(e,t)=>e<t,key:"noIsLessThan"},noIsInTheRange:{label:"is in the range",compareFunction:(e,t,n)=>t<=e&&e<=n,key:"noIsInTheRange"}},keys:()=>Object.keys(t.properties),values:()=>Object.values(t.properties)};Object.freeze(t);const n={CONTAINS:"soContains",DOES_NOT_CONTAIN:"soDoesNotContain",IS:"soIs",IS_NOT:"soIsNot",BEGINS_WITH:"soBeginsWith",ENDS_WITH:"soEndsWith"},s=(e,t,n)=>{if(R.isNil(e)||R.isNil(t))return!1;const s=Array.isArray(e)?e.join(" "):e;if(t.includes("|")){const e=t.split("|"),r=(e,t)=>n(s,t.trim())||e;return R.reduce(r,!1,e)}return n(s,t)},r=(e,t)=>s(e,t,((e,t)=>R.toLower(e).includes(R.toLower(t)))),o=(e,t)=>s(e,t,((e,t)=>e===t));n.properties={soContains:{label:"contains",compareFunction:r,key:"soContains"},soDoesNotContain:{label:"does not contain",compareFunction:(e,t)=>!r(e,t),key:"soDoesNotContain"},soIs:{label:"is",compareFunction:o,key:"soIs"},soIsNot:{label:"is not",compareFunction:(e,t)=>!o(e,t),key:"soIsNot"},soBeginsWith:{label:"begins with",compareFunction:(e,t)=>s(e,t,((e,t)=>e.startsWith(t))),key:"soBeginsWith"},soEndsWith:{label:"ends with",compareFunction:(e,t)=>s(e,t,((e,t)=>e.endsWith(t))),key:"soEndsWith"}},n.keys=()=>Object.keys(n.properties),n.values=()=>Object.values(n.properties),Object.freeze(n);const a={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",properties:{boolean:{name:"Boolean",key:"boolean"},number:{name:"Number",key:"number"},string:{name:"String",key:"string"}},keys:()=>Object.keys(a.properties),values:()=>Object.values(a.properties)};Object.freeze(a);const i={booleanOperator:t=>e.properties[t],clauseType:e=>a.properties[e],clauseTypeByOperator:e=>{let t=a.STRING;return i.booleanOperator(e)?t=a.BOOLEAN:i.numberOperator(e)&&(t=a.NUMBER),t},compareFunction:e=>i.operator(e).compareFunction,numberOperator:e=>t.properties[e],operator:e=>i.booleanOperator(e)||i.numberOperator(e)||i.stringOperator(e),operatorType:s=>{let r=n;if(s)switch(s){case a.BOOLEAN:r=e;break;case a.NUMBER:r=t;break;case a.STRING:default:r=n}return r},stringOperator:e=>n.properties[e]};Object.freeze(i);const l={create:({itemKey:e,operatorKey:t,rhs:n,rhs2:s})=>Immutable({itemKey:e,operatorKey:t,rhs:n,rhs2:s}),isBooleanClause:t=>!R.isNil(t)&&e.keys().includes(t.operatorKey),isNumberClause:e=>!R.isNil(e)&&t.keys().includes(e.operatorKey),isStringClause:e=>!R.isNil(e)&&n.keys().includes(e.operatorKey),passes:e=>t=>{if(e&&t){const n=i.compareFunction(e.operatorKey);if(n){return n(t[e.itemKey],e.rhs,e.rhs2)}}return!1}};Object.freeze(l);const c={create:({name:e="Filter",clauses:t=[]})=>Immutable({name:e,clauses:t}),passes:e=>t=>{if(e&&t){const n=(e,n)=>e&&l.passes(n)(t);return R.reduce(n,!0,e.clauses)}return!1}};Object.freeze(c);const u={tableColumn:(e,t)=>{const n=R.filter((e=>e.key===t),e);return n.length>0?n[0]:void 0}};Object.freeze(u);const p=ReactComponent.ReactUtilities,d=e=>"string"==typeof e?Number(e):e,h=e=>p.createCell("",e),m=(e,n,s,r,o,l)=>{let c;switch(i.clauseTypeByOperator(e.operatorKey)){case a.BOOLEAN:c=(e=>[h(`rhsBooleanField1${e}`),h(`rhsBooleanField2${e}`),h(`rhsBooleanField3${e}`)])(n);break;case a.NUMBER:c=((e,n,s,r,o,a)=>{const i=`rhsField${n}`,l=e?d(e.rhs):void 0;if(e.operatorKey===t.IS_IN_THE_RANGE){const t=e?d(e.rhs2):void 0;return[p.createCell(React.createElement(ReactComponent.NumberInput,{id:i,className:"fjs-number-input",initialValue:l||0,max:o,min:r,step:a,onBlur:s}),`rhs1NumberField1${n}`),p.createCell(ReactDOMFactories.span({style:{paddingLeft:3,paddingRight:3}},"to"),`toField${n}`),p.createCell(React.createElement(ReactComponent.NumberInput,{id:`rhs2Field${n}`,className:"fjs-number-input",initialValue:t||0,max:o,min:r,step:a,onBlur:s}),`rhs2NumberField3${n}`)]}return[p.createCell(React.createElement(ReactComponent.NumberInput,{id:i,className:"fjs-number-input",initialValue:l||0,max:o,min:r,step:a,onBlur:s}),`rhsNumberField1${n}`),h(`rhsNumberField2${n}`),h(`rhsNumberField3${n}`)]})(e,n,s,r,o,l);break;case a.STRING:c=((e,t,n)=>{const s=`rhsField${t}`;return[p.createCell(React.createElement(ReactComponent.StringInput,{id:s,className:"fjs-string-input",initialValue:e?e.rhs:void 0,onBlur:n}),`rhsStringField1${t}`),h(`rhsStringField2${t}`),h(`rhsStringField3${t}`)]})(e,n,s);break;default:throw new Error(`Unknown clause clauseTypeKey: ${e.clauseTypeKey}`)}return c};class b extends React.PureComponent{constructor(e){super(e),this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(){const{addOnClick:e,index:t}=this.props;e(t)}handleChangeFunction(){const{index:e,onChange:t,tableColumns:n}=this.props,s=((e,t)=>{const n=document.getElementById(`columnSelect${t}`).value;return u.tableColumn(e,n)})(n,e),r=((e,t)=>{const n=document.getElementById(`operatorSelect${t}`).value,s=i.operatorType(e.type),r=s.values();return s.keys().includes(n)?n:r[0].key})(s,e),o=(e=>{const t=document.getElementById(`rhsField${e}`);return t?t.value:void 0})(e),c=(e=>{const t=document.getElementById(`rhs2Field${e}`);return t?t.value:void 0})(e);let p;switch(s.type){case a.BOOLEAN:p=l.create({itemKey:s.key,operatorKey:r});break;case a.NUMBER:p=l.create({itemKey:s.key,operatorKey:r,rhs:d(o)||0,rhs2:d(c)});break;case a.STRING:case void 0:p=l.create({itemKey:s.key,operatorKey:r,rhs:o||""});break;default:throw new Error(`Unknown column.type: ${s.type}`)}t(p,e)}handleRemoveOnClickFunction(){const{removeOnClick:e,index:t}=this.props;e(t)}render(){const{clause:e,index:t,isRemoveHidden:n,tableColumns:s}=this.props,r=((e,t)=>{const n=Object.values(e)[0].key,s=t&&t.itemKey||n;return u.tableColumn(e,s)})(s,e);var o;const a=[p.createCell(((e,t,n,s,r)=>React.createElement(ReactComponent.Select,{id:`columnSelect${n}`,className:"fjs-select",values:e,initialValue:s.key,onChange:r}))(s,0,t,r,this.handleChange),`${r.key}ColumnSelectCell${t}`),p.createCell(((e,t,n,s)=>{const r=i.operatorType(n.type);if(r){const n=r.values();return React.createElement(ReactComponent.Select,{id:`operatorSelect${t}`,className:"fjs-select",values:n,initialValue:e?e.operatorKey:void 0,onChange:s})}return null})(e,t,r,this.handleChange),`${r.key}OperatorSelectCell${t}`),m(e,t,this.handleChange,r.min,r.max,r.step),p.createCell(((e,t)=>ReactDOMFactories.button({hidden:e,onClick:t},"-"))(n,this.handleRemoveOnClick),`removeButtonCell${t}`),p.createCell((o=this.handleAddOnClick,ReactDOMFactories.button({onClick:o},"+")),`addButtonCell${t}`)];return p.createRow(a,`${r.key}ClauseUI${t}`,"fjs-clause-ui")}}b.propTypes={addOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,clause:PropTypes.shape(),index:PropTypes.number,isRemoveHidden:PropTypes.bool},b.defaultProps={clause:void 0,index:void 0,isRemoveHidden:!1};const y=ReactComponent.ReactUtilities,C=s=>{let r;if(s)switch(s.type){case a.BOOLEAN:r=l.create({itemKey:s.key,operatorKey:Object.keys(e.properties)[0]});break;case a.NUMBER:r=l.create({itemKey:s.key,operatorKey:Object.keys(t.properties)[0],rhs:0});break;case a.STRING:case void 0:r=l.create({itemKey:s.key,operatorKey:Object.keys(n.properties)[0],rhs:""});break;default:throw new Error(`Unknown tableColumn.type: ${s.type}`)}return r},k=e=>{const t=R.filter((e=>[void 0,"true",!0].includes(e.isShown)),e),n=t&&t.length>0?t[0]:void 0,s=[C(n)];return c.create({name:"Filter 1",clauses:s})};class O extends React.PureComponent{constructor(e){super(e);const{filter:t,tableColumns:n}=this.props,s=t||k(n);this.state={filter:s},this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(e){const{onChange:t,tableColumns:n}=this.props,{filter:s}=this.state,r=n[0],o=C(r),a=R.insert(e+1,o,s.clauses),i=c.create({name:s.name,clauses:a});this.setState({filter:i}),t(i)}handleChangeFunction(e,t){const{onChange:n}=this.props,{filter:s}=this.state,r=R.update(t,e,s.clauses),o=c.create({name:s.name,clauses:r});this.setState({filter:o}),n(o)}handleRemoveOnClickFunction(e){const{onChange:t}=this.props,{filter:n}=this.state,s=R.remove(e,1,n.clauses),r=c.create({name:n.name,clauses:s});this.setState({filter:r}),t(r)}createButtonTable(){const{applyOnClick:e,removeOnClick:t}=this.props,n=ReactDOMFactories.button({onClick:t},"Remove"),s=ReactDOMFactories.button({onClick:e},"Apply"),r=[y.createCell(n,"unfilterButton","button"),y.createCell(s,"filterButton","button")],o=y.createRow(r,"button-row");return y.createTable(o,"buttonTable","fjs-button-table fr")}createTable(){const e=[],{tableColumns:t}=this.props,{filter:n}=this.state,{handleAddOnClick:s,handleChange:r,handleRemoveOnClick:o}=this,a=n||k(t),i=R.concat([],a.clauses);if(0===i.length){const e=t[0],n=C(e);i.push(n)}for(let n=0;n<i.length;n+=1){const a=i[n],l=1===i.length&&0===n,c=React.createElement(b,{key:`ClauseUI${n}`,clause:a,index:n,isRemoveHidden:l,tableColumns:t,onChange:r,addOnClick:s,removeOnClick:o});e.push(c)}return y.createTable(e,"filterTable")}render(){const e=y.createCell(this.createTable(),"filterTable","inner-table"),t=y.createRow(e,"filterTableCells"),n=y.createTable(t,"filterTableRow"),s=y.createCell(n,"filterTable"),r=y.createCell(this.createButtonTable(),"buttonTable","fjs-button-panel"),o=[y.createRow(s,"filterTablesRow"),y.createRow(r,"buttonRow")];return y.createTable(o,"filterTable","fjs-filter-ui")}}O.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,filter:PropTypes.shape()},O.defaultProps={filter:void 0};class f{}return f.BooleanOperator=e,f.NumberOperator=t,f.StringOperator=n,f.Clause=l,f.Filter=c,f.FilterUI=O,f}));
