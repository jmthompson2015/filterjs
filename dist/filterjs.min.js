!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilterJS=t()}(this,(function(){"use strict";const e={IS_TRUE:"boIsTrue",IS_FALSE:"boIsFalse",properties:{boIsTrue:{label:"is true",compareFunction:e=>!0===e,key:"boIsTrue"},boIsFalse:{label:"is false",compareFunction:e=>!1===e,key:"boIsFalse"}},keys:()=>Object.keys(e.properties),values:()=>Object.values(e.properties)};Object.freeze(e);const t={IS:"noIs",IS_NOT:"noIsNot",IS_GREATER_THAN:"noIsGreaterThan",IS_LESS_THAN:"noIsLessThan",IS_IN_THE_RANGE:"noIsInTheRange",properties:{noIs:{label:"is",compareFunction:(e,t)=>e===t,key:"noIs"},noIsNot:{label:"is not",compareFunction:(e,t)=>e!==t,key:"noIsNot"},noIsGreaterThan:{label:"is greater than",compareFunction:(e,t)=>e>t,key:"noIsGreaterThan"},noIsLessThan:{label:"is less than",compareFunction:(e,t)=>e<t,key:"noIsLessThan"},noIsInTheRange:{label:"is in the range",compareFunction:(e,t,n)=>t<=e&&e<=n,key:"noIsInTheRange"}},keys:()=>Object.keys(t.properties),values:()=>Object.values(t.properties)};Object.freeze(t);const n={CONTAINS:"soContains",DOES_NOT_CONTAIN:"soDoesNotContain",IS:"soIs",IS_NOT:"soIsNot",BEGINS_WITH:"soBeginsWith",ENDS_WITH:"soEndsWith"},s=(e,t,n)=>{if(R.isNil(e)||R.isNil(t))return!1;const s=Array.isArray(e)?e.join(" "):e;if(t.includes("|")){const e=t.split("|"),r=(e,t)=>n(s,t.trim())||e;return R.reduce(r,!1,e)}return n(s,t)},r=(e,t)=>s(e,t,((e,t)=>R.toLower(e).includes(R.toLower(t)))),a=(e,t)=>s(e,t,((e,t)=>e===t));n.properties={soContains:{label:"contains",compareFunction:r,key:"soContains"},soDoesNotContain:{label:"does not contain",compareFunction:(e,t)=>!r(e,t),key:"soDoesNotContain"},soIs:{label:"is",compareFunction:a,key:"soIs"},soIsNot:{label:"is not",compareFunction:(e,t)=>!a(e,t),key:"soIsNot"},soBeginsWith:{label:"begins with",compareFunction:(e,t)=>s(e,t,((e,t)=>e.startsWith(t))),key:"soBeginsWith"},soEndsWith:{label:"ends with",compareFunction:(e,t)=>s(e,t,((e,t)=>e.endsWith(t))),key:"soEndsWith"}},n.keys=()=>Object.keys(n.properties),n.values=()=>Object.values(n.properties),Object.freeze(n);const o={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",properties:{boolean:{name:"Boolean",key:"boolean"},number:{name:"Number",key:"number"},string:{name:"String",key:"string"}},keys:()=>Object.keys(o.properties),values:()=>Object.values(o.properties)};Object.freeze(o);const i={booleanOperator:t=>e.properties[t],clauseType:e=>o.properties[e],clauseTypeByOperator:e=>{let t=o.STRING;return i.booleanOperator(e)?t=o.BOOLEAN:i.numberOperator(e)&&(t=o.NUMBER),t},compareFunction:e=>i.operator(e).compareFunction,numberOperator:e=>t.properties[e],operator:e=>i.booleanOperator(e)||i.numberOperator(e)||i.stringOperator(e),operatorType:s=>{let r=n;if(s)switch(s){case o.BOOLEAN:r=e;break;case o.NUMBER:r=t;break;case o.STRING:default:r=n}return r},stringOperator:e=>n.properties[e]};Object.freeze(i);const l={create:({itemKey:e,operatorKey:t,rhs:n,rhs2:s})=>Immutable({itemKey:e,operatorKey:t,rhs:n,rhs2:s}),isBooleanClause:t=>!R.isNil(t)&&e.keys().includes(t.operatorKey),isNumberClause:e=>!R.isNil(e)&&t.keys().includes(e.operatorKey),isStringClause:e=>!R.isNil(e)&&n.keys().includes(e.operatorKey),passes:e=>t=>{if(e&&t){const n=i.compareFunction(e.operatorKey);if(n){return n(t[e.itemKey],e.rhs,e.rhs2)}}return!1}};Object.freeze(l);const c={create:({name:e="Filter",clauses:t=[]})=>Immutable({name:e,clauses:t}),passes:e=>t=>{if(e&&t){const n=(e,n)=>e&&l.passes(n)(t);return R.reduce(n,!0,e.clauses)}return!1}};Object.freeze(c);class u extends React.PureComponent{constructor(e){super(e);const{initialValue:t}=this.props;this.state={value:t},this.handleBlur=this.handleBlurFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this)}handleBlurFunction(){const{onBlur:e}=this.props,{value:t}=this.state;e(Number(t))}handleChangeFunction(e){const{value:t}=e.target,n=Number(t);this.setState({value:n})}render(){const{className:e,id:t,initialValue:n,max:s,min:r,step:a}=this.props;return ReactDOMFactories.input({id:t,type:"number",className:e,defaultValue:n,max:s,min:r,step:a,onBlur:this.handleBlur,onChange:this.handleChange})}}u.propTypes={onBlur:PropTypes.func.isRequired,id:PropTypes.string,className:PropTypes.string,initialValue:PropTypes.number,max:PropTypes.number,min:PropTypes.number,step:PropTypes.number},u.defaultProps={id:"numberInput",className:void 0,initialValue:0,max:void 0,min:void 0,step:void 0};const p={createCell:(e,t,n,s={})=>{const r=R.merge(s,{key:t,className:n,style:{display:"table-cell"}});return ReactDOMFactories.div(r,e)},createRow:(e,t,n,s={})=>{const r=R.merge(s,{key:t,className:n,style:{display:"table-row"}});return ReactDOMFactories.div(r,e)},createTable:(e,t,n,s={})=>{const r=R.merge(s,{key:t,className:n,style:{display:"table"}});return ReactDOMFactories.div(r,e)}};class d extends React.PureComponent{constructor(e){super(e),this.handleChange=this.handleChangeFunction.bind(this)}handleChangeFunction(){const{id:e,onChange:t}=this.props,n=document.getElementById(e);t(n.options[n.selectedIndex].value)}render(){const{id:e,values:t,initialValue:n}=this.props,s=R.map((e=>{return t=e.key,n=e.label,ReactDOMFactories.option({key:t,value:t},n);var t,n}),t);return ReactDOMFactories.select({id:e,defaultValue:n,onChange:this.handleChange},s)}}d.propTypes={values:PropTypes.arrayOf(PropTypes.shape()).isRequired,onChange:PropTypes.func.isRequired,id:PropTypes.string,initialValue:PropTypes.string},d.defaultProps={id:"select",initialValue:void 0};class h extends React.PureComponent{constructor(e){super(e);const{initialValue:t}=this.props;this.state={value:t},this.handleBlur=this.handleBlurFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this)}handleBlurFunction(){const{onBlur:e}=this.props,{value:t}=this.state;e(t)}handleChangeFunction(e){const{value:t}=e.target;this.setState({value:t})}render(){const{className:e,id:t,initialValue:n}=this.props;return ReactDOMFactories.input({id:t,type:"text",className:e,defaultValue:n,onBlur:this.handleBlur,onChange:this.handleChange})}}h.propTypes={onBlur:PropTypes.func.isRequired,id:PropTypes.string,className:PropTypes.string,initialValue:PropTypes.string},h.defaultProps={id:"stringInput",className:void 0,initialValue:""};const m={tableColumn:(e,t)=>{const n=R.filter((e=>e.key===t),e);return n.length>0?n[0]:void 0}};Object.freeze(m);const y=e=>"string"==typeof e?Number(e):e,b=e=>p.createCell("",e),C=(e,n,s,r,a,l)=>{let c;switch(i.clauseTypeByOperator(e.operatorKey)){case o.BOOLEAN:c=(e=>[b(`rhsBooleanField1${e}`),b(`rhsBooleanField2${e}`),b(`rhsBooleanField3${e}`)])(n);break;case o.NUMBER:c=((e,n,s,r,a,o)=>{const i=`rhsField${n}`,l=e?y(e.rhs):void 0;if(e.operatorKey===t.IS_IN_THE_RANGE){const t=e?y(e.rhs2):void 0;return[p.createCell(React.createElement(u,{id:i,className:"field",initialValue:l||0,max:a,min:r,step:o,onBlur:s}),`rhs1NumberField1${n}`),p.createCell(ReactDOMFactories.span({style:{paddingLeft:3,paddingRight:3}},"to"),`toField${n}`),p.createCell(React.createElement(u,{id:`rhs2Field${n}`,className:"field",initialValue:t||0,max:a,min:r,step:o,onBlur:s}),`rhs2NumberField3${n}`)]}return[p.createCell(React.createElement(u,{id:i,className:"field",initialValue:l||0,max:a,min:r,step:o,onBlur:s}),`rhsNumberField1${n}`),b(`rhsNumberField2${n}`),b(`rhsNumberField3${n}`)]})(e,n,s,r,a,l);break;case o.STRING:c=((e,t,n)=>{const s=`rhsField${t}`;return[p.createCell(React.createElement(h,{id:s,className:"field",initialValue:e?e.rhs:void 0,onBlur:n}),`rhsStringField1${t}`),b(`rhsStringField2${t}`),b(`rhsStringField3${t}`)]})(e,n,s);break;default:throw new Error(`Unknown clause clauseTypeKey: ${e.clauseTypeKey}`)}return c};class k extends React.PureComponent{constructor(e){super(e),this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(){const{addOnClick:e,index:t}=this.props;e(t)}handleChangeFunction(){const{index:e,onChange:t,tableColumns:n}=this.props,s=((e,t)=>{const n=document.getElementById(`columnSelect${t}`).value;return m.tableColumn(e,n)})(n,e),r=((e,t)=>{const n=document.getElementById(`operatorSelect${t}`).value,s=i.operatorType(e.type),r=s.values();return s.keys().includes(n)?n:r[0].key})(s,e),a=(e=>{const t=document.getElementById(`rhsField${e}`);return t?t.value:void 0})(e),c=(e=>{const t=document.getElementById(`rhs2Field${e}`);return t?t.value:void 0})(e);let u;switch(s.type){case o.BOOLEAN:u=l.create({itemKey:s.key,operatorKey:r});break;case o.NUMBER:u=l.create({itemKey:s.key,operatorKey:r,rhs:y(a)||0,rhs2:y(c)});break;case o.STRING:case void 0:u=l.create({itemKey:s.key,operatorKey:r,rhs:a||""});break;default:throw new Error(`Unknown column.type: ${s.type}`)}t(u,e)}handleRemoveOnClickFunction(){const{removeOnClick:e,index:t}=this.props;e(t)}render(){const{clause:e,index:t,isRemoveHidden:n,tableColumns:s}=this.props,r=((e,t)=>{const n=Object.values(e)[0].key,s=t&&t.itemKey||n;return m.tableColumn(e,s)})(s,e);var a;const o=[p.createCell(((e,t,n,s,r)=>React.createElement(d,{id:`columnSelect${n}`,values:e,initialValue:s.key,onChange:r}))(s,0,t,r,this.handleChange),`${r.key}ColumnSelectCell${t}`),p.createCell(((e,t,n,s)=>{const r=i.operatorType(n.type);if(r){const n=r.values();return React.createElement(d,{id:`operatorSelect${t}`,values:n,initialValue:e?e.operatorKey:void 0,onChange:s})}return null})(e,t,r,this.handleChange),`${r.key}OperatorSelectCell${t}`),C(e,t,this.handleChange,r.min,r.max,r.step),p.createCell(((e,t)=>ReactDOMFactories.button({hidden:e,onClick:t},"-"))(n,this.handleRemoveOnClick),`removeButtonCell${t}`),p.createCell((a=this.handleAddOnClick,ReactDOMFactories.button({onClick:a},"+")),`addButtonCell${t}`)];return p.createRow(o,`${r.key}ClauseUI${t}`,"fjs-clause-row")}}k.propTypes={addOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,clause:PropTypes.shape(),index:PropTypes.number,isRemoveHidden:PropTypes.bool},k.defaultProps={clause:void 0,index:void 0,isRemoveHidden:!1};const T=s=>{let r;if(s)switch(s.type){case o.BOOLEAN:r=l.create({itemKey:s.key,operatorKey:Object.keys(e.properties)[0]});break;case o.NUMBER:r=l.create({itemKey:s.key,operatorKey:Object.keys(t.properties)[0],rhs:0});break;case o.STRING:case void 0:r=l.create({itemKey:s.key,operatorKey:Object.keys(n.properties)[0],rhs:""});break;default:throw new Error(`Unknown tableColumn.type: ${s.type}`)}return r},O=e=>{const t=R.filter((e=>[void 0,"true",!0].includes(e.isShown)),e),n=t&&t.length>0?t[0]:void 0,s=[T(n)];return c.create({name:"Filter 1",clauses:s})};class f extends React.PureComponent{constructor(e){super(e);const{filter:t,tableColumns:n}=this.props,s=t||O(n);this.state={filter:s},this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(e){const{onChange:t,tableColumns:n}=this.props,{filter:s}=this.state,r=n[0],a=T(r),o=R.insert(e+1,a,s.clauses),i=c.create({name:s.name,clauses:o});this.setState({filter:i}),t(i)}handleChangeFunction(e,t){const{onChange:n}=this.props,{filter:s}=this.state,r=R.update(t,e,s.clauses),a=c.create({name:s.name,clauses:r});this.setState({filter:a}),n(a)}handleRemoveOnClickFunction(e){const{onChange:t}=this.props,{filter:n}=this.state,s=R.remove(e,1,n.clauses),r=c.create({name:n.name,clauses:s});this.setState({filter:r}),t(r)}createButtonTable(){const{applyOnClick:e,removeOnClick:t}=this.props,n=ReactDOMFactories.button({onClick:t},"Remove"),s=ReactDOMFactories.button({onClick:e},"Apply"),r=[p.createCell(n,"unfilterButton","button"),p.createCell(s,"filterButton","button")],a=p.createRow(r,"button-row");return p.createTable(a,"buttonTable","buttons")}createTable(){const e=[],{tableColumns:t}=this.props,{filter:n}=this.state,{handleAddOnClick:s,handleChange:r,handleRemoveOnClick:a}=this,o=n||O(t),i=R.concat([],o.clauses);if(0===i.length){const e=t[0],n=T(e);i.push(n)}for(let n=0;n<i.length;n+=1){const o=i[n],l=1===i.length&&0===n,c=React.createElement(k,{key:`ClauseUI${n}`,clause:o,index:n,isRemoveHidden:l,tableColumns:t,onChange:r,addOnClick:s,removeOnClick:a});e.push(c)}return p.createTable(e,"filterTable")}render(){const e=p.createCell(this.createTable(),"filterTable","inner-table"),t=p.createRow(e,"filterTableCells"),n=p.createTable(t,"filterTableRow"),s=p.createCell(n,"filterTable"),r=p.createCell(this.createButtonTable(),"buttonTable","button-panel"),a=[p.createRow(s,"filterTablesRow"),p.createRow(r,"buttonRow")];return p.createTable(a,"filterTable","fjs-filter")}}f.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,filter:PropTypes.shape()},f.defaultProps={filter:void 0};class g{}return g.BooleanOperator=e,g.NumberOperator=t,g.StringOperator=n,g.Clause=l,g.Filter=c,g.FilterUI=f,g}));
