!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilterJS=t()}(this,(function(){"use strict";const e={IS_TRUE:"boIsTrue",IS_FALSE:"boIsFalse",properties:{boIsTrue:{label:"is true",compareFunction:e=>!0===e,key:"boIsTrue"},boIsFalse:{label:"is false",compareFunction:e=>!1===e,key:"boIsFalse"}},keys:()=>Object.keys(e.properties),values:()=>Object.values(e.properties)};Object.freeze(e);const t={IS:"noIs",IS_NOT:"noIsNot",IS_GREATER_THAN:"noIsGreaterThan",IS_LESS_THAN:"noIsLessThan",IS_IN_THE_RANGE:"noIsInTheRange",properties:{noIs:{label:"is",compareFunction:(e,t)=>e===t,key:"noIs"},noIsNot:{label:"is not",compareFunction:(e,t)=>e!==t,key:"noIsNot"},noIsGreaterThan:{label:"is greater than",compareFunction:(e,t)=>e>t,key:"noIsGreaterThan"},noIsLessThan:{label:"is less than",compareFunction:(e,t)=>e<t,key:"noIsLessThan"},noIsInTheRange:{label:"is in the range",compareFunction:(e,t,n)=>t<=e&&e<=n,key:"noIsInTheRange"}},keys:()=>Object.keys(t.properties),values:()=>Object.values(t.properties)};Object.freeze(t);const n={CONTAINS:"soContains",DOES_NOT_CONTAIN:"soDoesNotContain",IS:"soIs",IS_NOT:"soIsNot",BEGINS_WITH:"soBeginsWith",ENDS_WITH:"soEndsWith"},s=(e,t,s)=>{if(R.isNil(e)||R.isNil(t))return!1;const r=n.toString(e);if(t.includes("|")){const e=t.split("|"),n=(e,t)=>s(r,t.trim())||e;return R.reduce(n,!1,e)}return s(r,t)},r=(e,t)=>s(e,t,((e,t)=>{const s=n.toString(e),r=n.toString(t);return s.includes(r)})),a=(e,t)=>s(e,t,((e,t)=>e===t));n.properties={soContains:{label:"contains",compareFunction:r,key:"soContains"},soDoesNotContain:{label:"does not contain",compareFunction:(e,t)=>!r(e,t),key:"soDoesNotContain"},soIs:{label:"is",compareFunction:a,key:"soIs"},soIsNot:{label:"is not",compareFunction:(e,t)=>!a(e,t),key:"soIsNot"},soBeginsWith:{label:"begins with",compareFunction:(e,t)=>s(e,t,((e,t)=>e.startsWith(t))),key:"soBeginsWith"},soEndsWith:{label:"ends with",compareFunction:(e,t)=>s(e,t,((e,t)=>e.endsWith(t))),key:"soEndsWith"}},n.toString=e=>{let t=e;if(e)if(Array.isArray(e)){t=R.map(n.toString,e).join(" ")}else{const n=typeof e;switch(n){case"object":t=R.toLower(Object.values(e).join(" "));break;case"boolean":case"number":t=`${e}`;break;case"string":t=R.toLower(e);break;default:console.error(`Unknown item: ${e} type: ${n}`)}}return t},n.keys=()=>Object.keys(n.properties),n.values=()=>Object.values(n.properties),Object.freeze(n);const o={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",properties:{boolean:{name:"Boolean",key:"boolean"},number:{name:"Number",key:"number"},string:{name:"String",key:"string"}},keys:()=>Object.keys(o.properties),values:()=>Object.values(o.properties)};Object.freeze(o);const i={booleanOperator:t=>e.properties[t],clauseType:e=>o.properties[e],clauseTypeByOperator:e=>{let t=o.STRING;return i.booleanOperator(e)?t=o.BOOLEAN:i.numberOperator(e)&&(t=o.NUMBER),t},compareFunction:e=>i.operator(e).compareFunction,numberOperator:e=>t.properties[e],operator:e=>i.booleanOperator(e)||i.numberOperator(e)||i.stringOperator(e),operatorType:s=>{let r=n;if(s)switch(s){case o.BOOLEAN:r=e;break;case o.NUMBER:r=t;break;case o.STRING:default:r=n}return r},stringOperator:e=>n.properties[e]};Object.freeze(i);const l={create:({itemKey:e,operatorKey:t,rhs:n,rhs2:s})=>Immutable({itemKey:e,operatorKey:t,rhs:n,rhs2:s}),default:(s,r)=>{let a;if(s)switch(r){case o.BOOLEAN:a=l.create({itemKey:s,operatorKey:Object.keys(e.properties)[0]});break;case o.NUMBER:a=l.create({itemKey:s,operatorKey:Object.keys(t.properties)[0],rhs:0});break;case o.STRING:case void 0:a=l.create({itemKey:s,operatorKey:Object.keys(n.properties)[0],rhs:""});break;default:throw new Error(`Unknown clauseType: ${r}`)}return a},isBooleanClause:t=>!R.isNil(t)&&e.keys().includes(t.operatorKey),isNumberClause:e=>!R.isNil(e)&&t.keys().includes(e.operatorKey),isStringClause:e=>!R.isNil(e)&&n.keys().includes(e.operatorKey),passes:e=>t=>{if(e&&t){const n=i.compareFunction(e.operatorKey);if(n){return n(t[e.itemKey],e.rhs,e.rhs2)}}return!1}};Object.freeze(l);const c={create:({name:e="Filter",clauses:t=[]})=>Immutable({name:e,clauses:t}),default:(e,t=1)=>{const n=R.filter((e=>[void 0,"true",!0].includes(e.isShown)),e),s=n&&n.length>0?n[0]:void 0,r=l.default(s.key,s.type),a=r?[r]:[];return c.create({name:`Filter ${t}`,clauses:a})},passes:e=>t=>{if(e&&t){const n=(e,n)=>e&&l.passes(n)(t);return R.reduce(n,!0,e.clauses)}return!1}};Object.freeze(c);const u={create:({filters:e=[],selectedIndex:t})=>{let n=0;return Number.isInteger(t)&&t>=0&&t<e.length&&(n=t),Immutable({filters:e,selectedIndex:n})},default:e=>{const t=[c.default(e)];return u.create({filters:t})},selectedFilter:e=>{let t;if(e){const{filters:n,selectedIndex:s}=e;t=n[s]}return t}};Object.freeze(u);const p={tableColumn:(e,t)=>{const n=R.filter((e=>e.key===t),e);return n.length>0?n[0]:void 0}};Object.freeze(p);const h=ReactComponent.ReactUtilities,d=e=>"string"==typeof e?Number(e):e,m=e=>h.createCell("",e),b=(e,n,s,r,a,l)=>{let c;switch(i.clauseTypeByOperator(e.operatorKey)){case o.BOOLEAN:c=(e=>[m(`rhsBooleanField1${e}`),m(`rhsBooleanField2${e}`),m(`rhsBooleanField3${e}`)])(n);break;case o.NUMBER:c=((e,n,s,r,a,o)=>{const i=`rhsField${n}`,l=e?d(e.rhs):void 0;if(e.operatorKey===t.IS_IN_THE_RANGE){const t=e?d(e.rhs2):void 0;return[h.createCell(React.createElement(ReactComponent.NumberInput,{id:i,className:"fjs-number-input",initialValue:l||0,max:a,min:r,step:o,onBlur:s}),`rhs1NumberField1${n}`),h.createCell(ReactDOMFactories.span({style:{paddingLeft:3,paddingRight:3}},"to"),`toField${n}`),h.createCell(React.createElement(ReactComponent.NumberInput,{id:`rhs2Field${n}`,className:"fjs-number-input",initialValue:t||0,max:a,min:r,step:o,onBlur:s}),`rhs2NumberField3${n}`)]}return[h.createCell(React.createElement(ReactComponent.NumberInput,{id:i,className:"fjs-number-input",initialValue:l||0,max:a,min:r,step:o,onBlur:s}),`rhsNumberField1${n}`),m(`rhsNumberField2${n}`),m(`rhsNumberField3${n}`)]})(e,n,s,r,a,l);break;case o.STRING:c=((e,t,n)=>{const s=`rhsField${t}`;return[h.createCell(React.createElement(ReactComponent.StringInput,{id:s,className:"fjs-string-input",initialValue:e?e.rhs:void 0,onBlur:n}),`rhsStringField1${t}`),m(`rhsStringField2${t}`),m(`rhsStringField3${t}`)]})(e,n,s);break;default:throw new Error(`Unknown clause clauseTypeKey: ${e.clauseTypeKey}`)}return c};class C extends React.PureComponent{constructor(e){super(e),this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(){const{addOnClick:e,index:t}=this.props;e(t)}handleChangeFunction(){const{index:e,onChange:t,tableColumns:n}=this.props,s=((e,t)=>{const n=document.getElementById(`columnSelect${t}`).value;return p.tableColumn(e,n)})(n,e),r=((e,t)=>{const n=document.getElementById(`operatorSelect${t}`).value,s=i.operatorType(e.type),r=s.values();return s.keys().includes(n)?n:r[0].key})(s,e),a=(e=>{const t=document.getElementById(`rhsField${e}`);return t?t.value:void 0})(e),c=(e=>{const t=document.getElementById(`rhs2Field${e}`);return t?t.value:void 0})(e);let u;switch(s.type){case o.BOOLEAN:u=l.create({itemKey:s.key,operatorKey:r});break;case o.NUMBER:u=l.create({itemKey:s.key,operatorKey:r,rhs:d(a)||0,rhs2:d(c)});break;case o.STRING:case void 0:u=l.create({itemKey:s.key,operatorKey:r,rhs:a||""});break;default:throw new Error(`Unknown column.type: ${s.type}`)}t(u,e)}handleRemoveOnClickFunction(){const{removeOnClick:e,index:t}=this.props;e(t)}render(){const{clause:e,index:t,isRemoveHidden:n,tableColumns:s}=this.props,r=((e,t)=>{const n=Object.values(e)[0].key,s=t&&t.itemKey||n;return p.tableColumn(e,s)})(s,e);var a;const o=[h.createCell(((e,t,n,s,r)=>React.createElement(ReactComponent.Select,{id:`columnSelect${n}`,className:"fjs-select",values:e,initialValue:s.key,onChange:r}))(s,0,t,r,this.handleChange),`${r.key}ColumnSelectCell${t}`),h.createCell(((e,t,n,s)=>{const r=i.operatorType(n.type);if(r){const n=r.values();return React.createElement(ReactComponent.Select,{id:`operatorSelect${t}`,className:"fjs-select",values:n,initialValue:e?e.operatorKey:void 0,onChange:s})}return null})(e,t,r,this.handleChange),`${r.key}OperatorSelectCell${t}`),b(e,t,this.handleChange,r.min,r.max,r.step),h.createCell(((e,t)=>ReactDOMFactories.button({hidden:e,onClick:t},"-"))(n,this.handleRemoveOnClick),`removeButtonCell${t}`),h.createCell((a=this.handleAddOnClick,ReactDOMFactories.button({onClick:a},"+")),`addButtonCell${t}`)];return h.createRow(o,`${r.key}ClauseUI${t}`,"fjs-clause-ui")}}C.propTypes={addOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,clause:PropTypes.shape(),index:PropTypes.number,isRemoveHidden:PropTypes.bool},C.defaultProps={clause:void 0,index:void 0,isRemoveHidden:!1};const f=ReactComponent.ReactUtilities;class y extends React.PureComponent{constructor(e){super(e);const{filter:t,tableColumns:n}=this.props,s=t||c.default(n);this.state={filter:s},this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleNameChange=this.handleNameChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(e){const{onChange:t,tableColumns:n}=this.props,{filter:s}=this.state,r=n[0],a=l.default(r.key,r.type);if(a){const n=R.insert(e+1,a,s.clauses),r=c.create({name:s.name,clauses:n});this.setState({filter:r}),t(r)}}handleChangeFunction(e,t){const{onChange:n}=this.props,{filter:s}=this.state,r=R.update(t,e,s.clauses),a=c.create({name:s.name,clauses:r});this.setState({filter:a}),n(a)}handleNameChangeFunction(e){const{onChange:t}=this.props,{filter:n}=this.state,s=c.create({name:e,clauses:n.clauses});this.setState({filter:s}),t(s)}handleRemoveOnClickFunction(e){const{onChange:t}=this.props,{filter:n}=this.state,s=R.remove(e,1,n.clauses),r=c.create({name:n.name,clauses:s});this.setState({filter:r}),t(r)}createButtonTable(){const{applyOnClick:e,removeOnClick:t}=this.props,n=ReactDOMFactories.button({onClick:t},"Remove"),s=ReactDOMFactories.button({onClick:e},"Apply"),r=[f.createCell(n,"unfilterButton","button"),f.createCell(s,"filterButton","button")],a=f.createRow(r,"button-row");return f.createTable(a,"buttonTable","fjs-button-table fr")}createClauseTable(){const e=[],{tableColumns:t}=this.props,{filter:n}=this.state,{handleAddOnClick:s,handleChange:r,handleRemoveOnClick:a}=this,o=n||c.default(t),i=R.concat([],o.clauses);if(0===i.length){const e=t[0],n=l.default(e.key,e.type);n&&i.push(n)}for(let n=0;n<i.length;n+=1){const o=i[n],l=1===i.length&&0===n,c=React.createElement(C,{key:`ClauseUI${n}`,clause:o,index:n,isRemoveHidden:l,tableColumns:t,onChange:r,addOnClick:s,removeOnClick:a});e.push(c)}return f.createTable(e,"clauseTable")}render(){const{filter:e}=this.props,t=React.createElement(ReactComponent.StringInput,{initialValue:e?e.name:"Filter",onBlur:this.handleNameChange}),n=this.createClauseTable(),s=this.createButtonTable(),r=f.createCell(t,"filterNameTable","pb2"),a=f.createCell(n,"clauseTable"),o=f.createCell(s,"buttonTable","button-panel pt2"),i=[f.createRow(r,"nameRow"),f.createRow(a,"clausesRow"),f.createRow(o,"buttonRow")];return f.createTable(i,"filterTable","fjs-filter-ui")}}y.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,filter:PropTypes.shape()},y.defaultProps={filter:void 0};const k=ReactComponent.ReactUtilities,O=R.addIndex(R.map),F=R.addIndex(R.reduce);class T extends React.PureComponent{constructor(e){super(e);const{initialFilterGroup:t}=this.props;this.state={filterGroup:t},this.handleDeleteOnClick=this.handleDeleteOnClickFunction.bind(this),this.handleFilterChange=this.handleFilterChangeFunction.bind(this),this.handleFiltersChange=this.handleFiltersChangeFunction.bind(this),this.handleNewOnClick=this.handleNewOnClickFunction.bind(this)}handleFilterChangeFunction(e){const{onChange:t}=this.props,{filterGroup:n}=this.state,{filters:s,selectedIndex:r}=n,a=((e,t,n)=>O(((n,s)=>s===e?t:n),n))(r,e,s),o=u.create({filters:a,selectedIndex:r});this.setState({filterGroup:o}),t(o)}handleFiltersChangeFunction(e){const{onChange:t}=this.props,{filterGroup:n}=this.state,{filters:s}=n,r=R.map(R.prop("name"),s).indexOf(e),a=u.create({filters:s,selectedIndex:r});this.setState({filterGroup:a}),t(a)}handleDeleteOnClickFunction(){const{onChange:e}=this.props,{filterGroup:t}=this.state,{filters:n,selectedIndex:s}=t,r=((e,t)=>F(((t,n,s)=>s===e?t:R.append(n,t)),[],t))(s,n),a=s>0?s-1:0,o=u.create({filters:r,selectedIndex:a});this.setState({filterGroup:o}),e(o)}handleNewOnClickFunction(){const{onChange:e,tableColumns:t}=this.props,{filterGroup:n}=this.state,{filters:s}=n,r=s.length,a=c.default(t,r+1),o=R.append(a,s),i=u.create({filters:o,selectedIndex:r});this.setState({filterGroup:i}),e(i)}createButtonTable(){const{filterGroup:e}=this.state,{filters:t}=e,n=t.length<=1,s=ReactDOMFactories.button({onClick:this.handleDeleteOnClick,disabled:n},"-"),r=ReactDOMFactories.button({onClick:this.handleNewOnClick},"+"),a=[k.createCell(s,"deleteFilterButton","button"),k.createCell(r,"newFilterButton","button")],o=k.createRow(a,"button-row");return k.createTable(o,"buttonTable","fjs-button-table")}createFiltersList(){const{filterGroup:e}=this.state,{filters:t,selectedIndex:n}=e,s=t[n],r=Math.max(2+s.clauses.length,5),a=s.name,o=R.map(R.prop("name"),t),i=R.reduce(((e,t)=>R.append({key:t,label:t},e)),[],o);return React.createElement(ReactComponent.Select,{key:`${r}${JSON.stringify(s)}`,attributes:{size:r},initialValue:a,onChange:this.handleFiltersChange,values:i})}createFiltersTable(){const e=this.createFiltersList(),t=this.createButtonTable(),n=k.createCell(e,"filtersList"),s=k.createCell(t,"buttonTable","pt2"),r=[k.createRow(n,"filtersListRow"),k.createRow(s,"buttonTableRow")];return k.createTable(r,"filtersTable","filters-table")}createFilterUI(){const{applyOnClick:e,removeOnClick:t,tableColumns:n}=this.props,{filterGroup:s}=this.state,{filters:r,selectedIndex:a}=s,o=r.length>0?r[a]:void 0;return React.createElement(y,{key:JSON.stringify(o),applyOnClick:e,filter:o,onChange:this.handleFilterChange,removeOnClick:t,tableColumns:n})}render(){const e=this.createFiltersTable(),t=this.createFilterUI(),n=[k.createCell(e,"filtersTable","pr2 v-top"),k.createCell(t,"filterUI","v-top")],s=k.createRow(n,"filtersTableRow");return k.createTable(s,"filtersTable","fjs-filters-ui f6")}}T.propTypes={applyOnClick:PropTypes.func.isRequired,onChange:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,initialFilterGroup:PropTypes.shape()},T.defaultProps={initialFilterGroup:[]};class g{}return g.BooleanOperator=e,g.NumberOperator=t,g.StringOperator=n,g.Clause=l,g.Filter=c,g.FilterGroup=u,g.FilterUI=y,g.FilterGroupUI=T,g}));
